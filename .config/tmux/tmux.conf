# =======================
# TMUX PRO CONFIGURATION
# =======================

# Set true color support
set-option -sa terminal-overrides ",xterm*:Tc"
set -g default-terminal "screen-256color"

# Set prefix to C-n (keeping your preference)
unbind C-b
set -g prefix C-n
bind C-n send-prefix

# =======================
# GENERAL SETTINGS
# =======================

# Enable mouse support
set -g mouse on

# Start windows and panes at 1, not 0
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# Increase scrollback buffer size
set -g history-limit 50000

# Display tmux messages for 4 seconds
set -g display-time 4000

# Refresh 'status-left' and 'status-right' more often
set -g status-interval 5

# Upgrade $TERM
set -g default-terminal "screen-256color"

# Emacs key bindings in tmux command prompt
set -g status-keys emacs

# Focus events enabled for terminals that support them
set -g focus-events on

# Super useful when using "grouped sessions" and multi-monitor setup
setw -g aggressive-resize on

# =======================
# KEY BINDINGS
# =======================

# Reload config file (change file location to your the tmux.conf you want to use)
bind r source-file ~/.config/tmux/tmux.conf \; display-message "Config reloaded!"

# Split panes using | and -
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Switch panes using Alt-arrow without prefix
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Use vim keybindings in copy mode
setw -g mode-keys vi

# Setup 'v' to begin selection as in Vim
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# Quick window selection
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5

# Resize panes easily
bind -n M-H resize-pane -L 5
bind -n M-L resize-pane -R 5
bind -n M-K resize-pane -U 5
bind -n M-J resize-pane -D 5

# New window in current path
bind c new-window -c "#{pane_current_path}"

# =======================
# STATUS BAR DESIGN
# =======================

# Status bar colors and design
set -g status-bg "#1e1e2e"
set -g status-fg "#cdd6f4"

# Status bar position
set -g status-position bottom

# Status bar length
set -g status-left-length 85
set -g status-right-length 85

# Window status format
setw -g window-status-current-format "#[fg=#f38ba8,bg=#313244,bold] #I:#W#F "
setw -g window-status-format "#[fg=#6c7086,bg=#1e1e2e] #I:#W#F "

# Status left - Session name and current window
set -g status-left "#[fg=#89b4fa,bg=#313244,bold] 󰣇 #S #[fg=#313244,bg=#1e1e2e]"

# Status right - System info
set -g status-right "#[fg=#313244,bg=#1e1e2e]#[fg=#f9e2af,bg=#313244] %Y-%m-%d #[fg=#89dceb]󰥔 %H:%M #[fg=#a6e3a1]󰍛 #{host_short} "

# Pane borders
set -g pane-border-style fg="#6c7086"
set -g pane-active-border-style fg="#89b4fa"

# Message text
set -g message-style bg="#313244",fg="#cdd6f4"

# =======================
# PLUGINS
# =======================

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin 'sainnhe/tmux-fzf'
set -g @plugin 'wfxr/tmux-fzf-url'

# =======================
# PLUGIN CONFIGURATIONS
# =======================

# Tmux Resurrect - Save and restore tmux sessions
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-strategy-nvim 'session'

# Tmux Continuum - Automatic save/restore
set -g @continuum-restore 'on'
set -g @continuum-boot 'on'
set -g @continuum-save-interval '15'

# Prefix highlight
set -g @prefix_highlight_fg '#1e1e2e'
set -g @prefix_highlight_bg '#f38ba8'
set -g @prefix_highlight_show_copy_mode 'on'
set -g @prefix_highlight_copy_mode_attr 'fg=#1e1e2e,bg=#f9e2af'

# FZF configurations
set -g @fzf-url-bind 'u'
set -g @fzf-url-fzf-options '-p 60%,30% --prompt="   " --border-label=" Open URL "'

# TMUX FZF
TMUX_FZF_LAUNCH_KEY="C-f"
TMUX_FZF_ORDER="session|window|pane|command|keybinding|clipboard|process"
TMUX_FZF_OPTIONS="-p -w 80% -h 80% -m"

# =======================
# CUSTOM FUNCTIONS
# =======================

# Easy config editing
bind e new-window -n "tmux-config" "sh -c '\${EDITOR:-vim} ~/.config/tmux/tmux.conf && tmux source ~/.config/tmux/tmux.conf && tmux display \"Config reloaded!\"'"

# Quick session switcher with fzf
bind s display-popup -E "tmux list-sessions | sed -E 's/:.*$//' | grep -v \"^$(tmux display-message -p '#S')\$\" | fzf --reverse | xargs tmux switch-client -t"

# =======================
# INITIALIZE PLUGINS
# =======================

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.config/tmux/plugins/tpm/tpm'

# =======================
# ADDITIONAL BINDINGS
# =======================

# Clear screen and history
bind C-l send-keys 'C-l' \; clear-history

# Toggle status bar
bind S set-option -g status

# Synchronize panes
bind y setw synchronize-panes

# Create new session
bind N command-prompt -p "New session name:" "new-session -d -s '%%'"

# Kill session
bind X confirm-before -p "Kill session #S? (y/n)" kill-session
